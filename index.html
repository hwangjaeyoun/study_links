<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ§¸ ì˜ì–´ ìˆ˜ì—… ë§¤ë‹ˆì €</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        :root {
            --primary: #60a5fa;
            --bg: #f0f9ff;
            --card-bg: #ffffff;
            --text: #444;
        }

        body { 
            font-family: 'Pretendard', -apple-system, sans-serif; 
            background-color: var(--bg); 
            margin: 0; 
            padding: 15px; 
            color: var(--text); 
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container { width: 100%; max-width: 500px; }
        h1 { text-align: center; color: var(--primary); font-size: 1.5rem; margin: 10px 0 20px; }

        /* ì…ë ¥ ë° í•„í„° ì˜ì—­ */
        .panel { 
            background: white; padding: 20px; border-radius: 20px; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.05); margin-bottom: 20px;
            display: flex; flex-direction: column; gap: 10px;
        }

        select, input { 
            padding: 12px; border: 2px solid #e0f2fe; border-radius: 12px; 
            font-size: 16px; outline: none; transition: 0.3s;
        }

        input:focus { border-color: var(--primary); }

        .add-btn { 
            padding: 14px; background: var(--primary); color: white; border: none; 
            border-radius: 12px; font-weight: bold; font-size: 1rem; cursor: pointer;
        }

        /* ì¹´ë“œí˜• ë¦¬ìŠ¤íŠ¸ ë ˆì´ì•„ì›ƒ */
        .link-card {
            background: white; padding: 18px; border-radius: 20px; margin-bottom: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.03); position: relative;
            display: grid;
            grid-template-areas: 
                "user title title"
                "check info info"
                "link link actions";
            grid-template-columns: 70px 1fr auto;
            gap: 8px;
            border: 2px solid transparent;
        }

        .user-tag { 
            grid-area: user; background: #dcfce7; color: #166534; 
            padding: 4px 8px; border-radius: 8px; font-size: 0.8rem; text-align: center; font-weight: bold;
        }

        .title { grid-area: title; font-weight: bold; font-size: 1.1rem; align-self: center; }
        .info { grid-area: info; font-size: 0.85rem; color: #888; }
        .link-area { grid-area: link; margin-top: 10px; }
        .check-area { grid-area: check; display: flex; align-items: center; justify-content: center; }
        .actions { grid-area: actions; display: flex; gap: 8px; margin-top: 10px; }

        .link-url-btn {
            display: inline-block; background: #eff6ff; color: var(--primary);
            padding: 8px 15px; border-radius: 10px; text-decoration: none; font-weight: bold; font-size: 0.9rem;
        }

        .btn-small { padding: 6px 10px; border-radius: 8px; font-size: 0.8rem; border: none; cursor: pointer; }
        .edit-btn { background: #fef3c7; color: #92400e; }
        .delete-btn { background: #fee2e2; color: #991b1b; }

        /* ì²´í¬ë°•ìŠ¤ í¬ê¸° í‚¤ì›€ */
        input[type="checkbox"] { width: 26px; height: 26px; accent-color: var(--primary); }

        /* ì™„ë£Œ ìƒíƒœ */
        .done-card { background: #f8fafc; opacity: 0.7; border-color: #e2e8f0; }
        .done-card .title { text-decoration: line-through; color: #94a3b8; }

        /* ìˆ˜ì • ëª¨ë“œ ì¹´ë“œ */
        .edit-card { border: 2px dashed var(--primary); }
        .edit-card input { padding: 8px; font-size: 14px; width: 100%; box-sizing: border-box; }
        .save-btn { grid-area: actions; background: #bbf7d0; color: #166534; font-weight: bold; border-radius: 8px; border: none; padding: 10px; }

    </style>
</head>
<body>

<div class="container">
    <h1>â˜ï¸ ìˆ˜ì—… ë§í¬ ê´€ë¦¬</h1>

    <div class="panel">
        <select id="user-filter" onchange="renderLinks(allDataCache)">
            <option value="ì „ì²´">ëª¨ë“  ì¹œêµ¬ë“¤ ë³´ê¸°</option>
            <option value="í™©ë‹¤ì—°">í™©ë‹¤ì—°</option>
            <option value="ê¹€ë³´ì„">ê¹€ë³´ì„</option>
        </select>
        <hr style="width:100%; border:0; border-top:1px solid #eee; margin:5px 0;">
        <div style="display:flex; gap:10px;">
            <select id="new-user" style="flex:1;">
                <option value="">ì´ë¦„</option>
                <option value="í™©ë‹¤ì—°">í™©ë‹¤ì—°</option>
                <option value="ê¹€ë³´ì„">ê¹€ë³´ì„</option>
            </select>
            <input type="date" id="new-date" style="flex:2;">
        </div>
        <input type="text" id="new-title" placeholder="ìˆ˜ì—… ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">
        <input type="text" id="new-url" placeholder="URL ì£¼ì†Œë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”">
        <button class="add-btn" onclick="addLink()">ê¸°ë¡í•˜ê¸°</button>
    </div>

    <div id="card-container">
        <p style="text-align:center;">ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”... ğŸ§¸</p>
    </div>
</div>

<script>
    // Firebase ì„¤ì • (ê¸°ì¡´ ì„¤ì • ìœ ì§€)
    const firebaseConfig = {
        apiKey: "AIzaSyAHvOrb4B3c1uY7WwaR1yuQrwP5lDbRZiI",
        authDomain: "linkmanage-d8efd.firebaseapp.com",
        databaseURL: "https://linkmanage-d8efd-default-rtdb.firebaseio.com",
        projectId: "linkmanage-d8efd",
        storageBucket: "linkmanage-d8efd.firebasestorage.app",
        messagingSenderId: "517672204798",
        appId: "1:517672204798:web:ec8315e84a5120648868af",
        measurementId: "G-6J7VGJ2CXM"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let allDataCache = null;
    let editId = null;

    db.ref('class_links').on('value', (snapshot) => {
        allDataCache = snapshot.val();
        renderLinks(allDataCache); 
    });

    function addLink() {
        const user = document.getElementById('new-user').value;
        const date = document.getElementById('new-date').value;
        const title = document.getElementById('new-title').value;
        const url = document.getElementById('new-url').value;

        if (!user || !date || !title || !url) { alert("ëª¨ë“  ì¹¸ì„ ì±„ì›Œì£¼ì„¸ìš”! âœ¨"); return; }

        const newRef = db.ref('class_links').push();
        newRef.set({ id: newRef.key, user, date, title, url, checked: false, doneTime: '-' })
        .then(() => {
            document.getElementById('new-title').value = '';
            document.getElementById('new-url').value = '';
        });
    }

    function toggleCheck(id, currentStatus) {
        const now = new Date();
        const timeStr = !currentStatus ? `${now.getMonth()+1}/${now.getDate()} ${now.getHours()}:${String(now.getMinutes()).padStart(2,'0')}` : '-';
        db.ref('class_links/' + id).update({ checked: !currentStatus, doneTime: timeStr });
    }

    function startEdit(id) { editId = id; renderLinks(allDataCache); }

    function saveEdit(id) {
        const card = document.getElementById(`card-${id}`);
        const updateData = {
            date: card.querySelector('.edit-date').value,
            title: card.querySelector('.edit-title').value,
            url: card.querySelector('.edit-url').value
        };

        db.ref('class_links/' + id).update(updateData).then(() => {
            editId = null;
            alert("ì €ì¥ ì™„ë£Œ! âœ¨");
        });
    }

    function deleteLink(id) {
        if(confirm("ì´ ê¸°ë¡ì„ ì§€ìš¸ê¹Œìš”? ğŸ’¨")) { db.ref('class_links/' + id).remove(); }
    }

    function renderLinks(data) {
        const container = document.getElementById('card-container');
        const filter = document.getElementById('user-filter').value;
        container.innerHTML = '';
        
        if(!data) {
            container.innerHTML = '<p style="text-align:center;">ì•„ì§ ë“±ë¡ëœ ìˆ˜ì—…ì´ ì—†ì–´ìš”! ğŸŒ¸</p>';
            return;
        }

        Object.values(data).sort((a,b) => new Date(b.date) - new Date(a.date)).forEach(link => {
            if (filter !== "ì „ì²´" && link.user !== filter) return;

            const div = document.createElement('div');
            div.id = `card-${link.id}`;
            div.className = `link-card ${link.checked ? 'done-card' : ''} ${editId === link.id ? 'edit-card' : ''}`;

            if(editId === link.id) {
                // ìˆ˜ì • ëª¨ë“œ ë ˆì´ì•„ì›ƒ
                div.innerHTML = `
                    <span class="user-tag">${link.user}</span>
                    <div class="title" style="grid-area:title"><input type="text" class="edit-title" value="${link.title}"></div>
                    <div class="info" style="grid-area:info"><input type="date" class="edit-date" value="${link.date}"></div>
                    <div class="link-area"><input type="text" class="edit-url" value="${link.url}"></div>
                    <div class="actions"><button class="save-btn" onclick="saveEdit('${link.id}')">ì™„ë£Œ</button></div>
                `;
            } else {
                // ì¼ë°˜ ì¹´ë“œ ëª¨ë“œ ë ˆì´ì•„ì›ƒ
                div.innerHTML = `
                    <span class="user-tag">${link.user}</span>
                    <div class="title">${link.title}</div>
                    <div class="check-area">
                        <input type="checkbox" ${link.checked ? 'checked' : ''} onchange="toggleCheck('${link.id}', ${link.checked})">
                    </div>
                    <div class="info">ğŸ“… ${link.date} ${link.checked ? ` | âœ… ${link.doneTime}` : ''}</div>
                    <div class="link-area">
                        <a href="${link.url}" target="_blank" class="link-url-btn">ğŸ“º ì˜ìƒ ë³´ê¸°</a>
                    </div>
                    <div class="actions">
                        <button class="btn-small edit-btn" onclick="startEdit('${link.id}')">ìˆ˜ì •</button>
                        <button class="btn-small delete-btn" onclick="deleteLink('${link.id}')">ì‚­ì œ</button>
                    </div>
                `;
            }
            container.appendChild(div);
        });
    }
</script>
</body>
</html>
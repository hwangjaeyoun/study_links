<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ§¸ ì˜ì–´ ìˆ˜ì—… ë§¤ë‹ˆì €</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        :root {
            --primary: #60a5fa;
            --bg: #f0f9ff;
            --card-bg: #ffffff;
            --text: #444;
        }

        body { 
            font-family: 'Pretendard', -apple-system, sans-serif; 
            background-color: var(--bg); margin: 0; padding: 15px; color: var(--text); 
            display: flex; flex-direction: column; align-items: center;
        }

        .container { width: 100%; max-width: 500px; }
        h1 { text-align: center; color: var(--primary); font-size: 1.5rem; margin: 10px 0 20px; }

        .panel { 
            background: white; padding: 20px; border-radius: 20px; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.05); margin-bottom: 20px;
            display: flex; flex-direction: column; gap: 10px;
        }

        select, input { 
            padding: 12px; border: 2px solid #e0f2fe; border-radius: 12px; 
            font-size: 16px; outline: none;
        }

        .add-btn { 
            padding: 14px; background: var(--primary); color: white; border: none; 
            border-radius: 12px; font-weight: bold; font-size: 1rem; cursor: pointer;
        }

        /* ì¹´ë“œ ë ˆì´ì•„ì›ƒ ìˆ˜ì • */
        .link-card {
            background: white; padding: 18px; border-radius: 20px; margin-bottom: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.03);
            display: flex; flex-direction: column; gap: 10px;
            border: 2px solid transparent;
        }

        .card-header { display: flex; justify-content: space-between; align-items: flex-start; }
        .user-tag { 
            background: #dcfce7; color: #166534; padding: 4px 10px; 
            border-radius: 8px; font-size: 0.8rem; font-weight: bold;
        }
        
        /* ìˆ˜ì •/ì‚­ì œ ë²„íŠ¼: ì‘ê³  ê¹”ë”í•˜ê²Œ ìš°ì¸¡ ìƒë‹¨ ë°°ì¹˜ */
        .admin-btns { display: flex; gap: 5px; }
        .btn-mini { 
            padding: 4px 8px; font-size: 0.75rem; border-radius: 6px; 
            border: none; background: #f1f5f9; color: #94a3b8; cursor: pointer;
        }
        .btn-mini:hover { background: #e2e8f0; }

        .title { font-weight: bold; font-size: 1.15rem; line-height: 1.4; margin-top: 5px; }
        .info { font-size: 0.85rem; color: #888; display: flex; align-items: center; gap: 10px; }

        /* ì˜ìƒë³´ê¸° ë²„íŠ¼: ê°•ì¡° ë° í™•ëŒ€ */
        .video-btn-container { margin-top: 5px; display: flex; align-items: center; gap: 12px; }
        .link-url-btn {
            flex: 1; /* ê°€ë¡œ ê½‰ ì±„ìš°ê¸° */
            text-align: center; background: #2563eb; color: white;
            padding: 15px; border-radius: 15px; text-decoration: none; 
            font-weight: bold; font-size: 1.1rem; box-shadow: 0 4px 12px rgba(37, 99, 235, 0.2);
        }
        .link-url-btn:active { transform: scale(0.98); }

        /* ì²´í¬ë°•ìŠ¤ í¬ê¸° */
        input[type="checkbox"] { width: 28px; height: 28px; accent-color: #2563eb; cursor: pointer; }

        .done-card { background: #f8fafc; opacity: 0.7; }
        .done-card .title { text-decoration: line-through; color: #94a3b8; }
        .done-card .link-url-btn { background: #94a3b8; box-shadow: none; }

        /* ìˆ˜ì • ëª¨ë“œ */
        .edit-card { border: 2px dashed var(--primary); }
        .edit-input { width: 100%; padding: 10px; margin-bottom: 5px; border-radius: 8px; border: 1px solid #ddd; }
    </style>
</head>
<body>

<div class="container">
    <h1>â˜ï¸ ìˆ˜ì—… ë§í¬ ê´€ë¦¬</h1>

    <div class="panel">
        <select id="user-filter" onchange="renderLinks(allDataCache)">
            <option value="ì „ì²´">ëª¨ë“  ì¹œêµ¬ë“¤ ë³´ê¸°</option>
            <option value="í™©ë‹¤ì—°">í™©ë‹¤ì—°</option>
            <option value="ê¹€ë³´ì„">ê¹€ë³´ì„</option>
        </select>
        <div style="display:flex; gap:10px;">
            <select id="new-user" style="flex:1;">
                <option value="">ì´ë¦„</option>
                <option value="í™©ë‹¤ì—°">í™©ë‹¤ì—°</option>
                <option value="ê¹€ë³´ì„">ê¹€ë³´ì„</option>
            </select>
            <input type="date" id="new-date" style="flex:2;">
        </div>
        <input type="text" id="new-title" placeholder="ìˆ˜ì—… ì œëª© ì…ë ¥">
        <input type="text" id="new-url" placeholder="URL ì£¼ì†Œ ë¶™ì—¬ë„£ê¸°">
        <button class="add-btn" onclick="addLink()">ë¦¬ìŠ¤íŠ¸ì— ê¸°ë¡í•˜ê¸°</button>
    </div>

    <div id="card-container">
        <p style="text-align:center;">ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”... ğŸ§¸</p>
    </div>
</div>

<script>
    // Firebase ì„¤ì • (ê¸°ì¡´ ì •ë³´ ë™ì¼)
    const firebaseConfig = {
        apiKey: "AIzaSyAHvOrb4B3c1uY7WwaR1yuQrwP5lDbRZiI",
        authDomain: "linkmanage-d8efd.firebaseapp.com",
        databaseURL: "https://linkmanage-d8efd-default-rtdb.firebaseio.com",
        projectId: "linkmanage-d8efd",
        storageBucket: "linkmanage-d8efd.firebasestorage.app",
        messagingSenderId: "517672204798",
        appId: "1:517672204798:web:ec8315e84a5120648868af",
        measurementId: "G-6J7VGJ2CXM"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let allDataCache = null;
    let editId = null;

    db.ref('class_links').on('value', (snapshot) => {
        allDataCache = snapshot.val();
        renderLinks(allDataCache); 
    });

    function addLink() {
        const user = document.getElementById('new-user').value;
        const date = document.getElementById('new-date').value;
        const title = document.getElementById('new-title').value;
        const url = document.getElementById('new-url').value;

        if (!user || !date || !title || !url) { alert("ëª¨ë“  ì¹¸ì„ ì±„ì›Œì£¼ì„¸ìš”! âœ¨"); return; }

        const newRef = db.ref('class_links').push();
        newRef.set({ id: newRef.key, user, date, title, url, checked: false, doneTime: '-' })
        .then(() => {
            document.getElementById('new-title').value = '';
            document.getElementById('new-url').value = '';
        });
    }

    function toggleCheck(id, currentStatus) {
        const now = new Date();
        const timeStr = !currentStatus ? `${now.getMonth()+1}/${now.getDate()} ${now.getHours()}:${String(now.getMinutes()).padStart(2,'0')}` : '-';
        db.ref('class_links/' + id).update({ checked: !currentStatus, doneTime: timeStr });
    }

    function startEdit(id) { editId = id; renderLinks(allDataCache); }

    function saveEdit(id) {
        const card = document.getElementById(`card-${id}`);
        const updateData = {
            date: card.querySelector('.edit-date').value,
            title: card.querySelector('.edit-title').value,
            url: card.querySelector('.edit-url').value
        };
        db.ref('class_links/' + id).update(updateData).then(() => {
            editId = null;
        });
    }

    function deleteLink(id) {
        if(confirm("ì •ë§ ì‚­ì œí• ê¹Œìš”?")) { db.ref('class_links/' + id).remove(); }
    }

    function renderLinks(data) {
        const container = document.getElementById('card-container');
        const filter = document.getElementById('user-filter').value;
        container.innerHTML = '';
        
        if(!data) {
            container.innerHTML = '<p style="text-align:center;">ë“±ë¡ëœ ìˆ˜ì—…ì´ ì—†ì–´ìš”! ğŸŒ¸</p>';
            return;
        }

        Object.values(data).sort((a,b) => new Date(b.date) - new Date(a.date)).forEach(link => {
            if (filter !== "ì „ì²´" && link.user !== filter) return;

            const div = document.createElement('div');
            div.id = `card-${link.id}`;
            div.className = `link-card ${link.checked ? 'done-card' : ''}`;

            if(editId === link.id) {
                div.innerHTML = `
                    <input type="text" class="edit-input edit-title" value="${link.title}">
                    <input type="date" class="edit-input edit-date" value="${link.date}">
                    <input type="text" class="edit-input edit-url" value="${link.url}">
                    <button class="add-btn" onclick="saveEdit('${link.id}')">ìˆ˜ì • ì™„ë£Œ</button>
                `;
            } else {
                div.innerHTML = `
                    <div class="card-header">
                        <span class="user-tag">${link.user}</span>
                        <div class="admin-btns">
                            <button class="btn-mini" onclick="startEdit('${link.id}')">ìˆ˜ì •</button>
                            <button class="btn-mini" onclick="deleteLink('${link.id}')">ì‚­ì œ</button>
                        </div>
                    </div>
                    <div class="title">${link.title}</div>
                    <div class="info">
                        ğŸ“… ${link.date} ${link.checked ? ` | âœ… ${link.doneTime}` : ''}
                    </div>
                    <div class="video-btn-container">
                        <input type="checkbox" ${link.checked ? 'checked' : ''} onchange="toggleCheck('${link.id}', ${link.checked})">
                        <a href="${link.url}" target="_blank" class="link-url-btn">â–¶ ì˜ìƒ ë°”ë¡œë³´ê¸°</a>
                    </div>
                `;
            }
            container.appendChild(div);
        });
    }
</script>
</body>
</html>
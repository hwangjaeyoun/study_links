<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ“± ìˆ˜ì—… ê´€ë¦¬</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        :root { --primary: #60a5fa; --bg: #f0f9ff; --text: #444; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: var(--bg); margin: 0; padding: 15px; color: var(--text); }
        
        /* ìƒë‹¨ í—¤ë” ë° ë²„íŠ¼ */
        .header { display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px; }
        .reg-btn-mob { background: var(--primary); color: white; text-align: center; padding: 15px; border-radius: 15px; text-decoration: none; font-weight: bold; font-size: 1.1rem; box-shadow: 0 4px 10px rgba(96, 165, 250, 0.3); }
        select { padding: 12px; border-radius: 12px; border: 2px solid #e0f2fe; background: white; font-size: 16px; outline: none; }

        /* ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .link-card { background: white; padding: 18px; border-radius: 20px; margin-bottom: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.03); display: flex; flex-direction: column; gap: 10px; transition: 0.3s; }
        .card-header { display: flex; justify-content: space-between; align-items: center; }
        .user-tag { background: #dcfce7; color: #166534; padding: 4px 10px; border-radius: 8px; font-size: 0.8rem; font-weight: bold; }
        
        /* ìˆ˜ì •/ì‚­ì œ ë¯¸ë‹ˆ ë²„íŠ¼ */
        .admin-btns { display: flex; gap: 8px; }
        .btn-mini { padding: 5px 10px; font-size: 0.75rem; border-radius: 6px; border: none; background: #f1f5f9; color: #94a3b8; cursor: pointer; }

        /* ì œëª© ë° ì •ë³´ */
        .title-text { font-weight: bold; font-size: 1.1rem; line-height: 1.4; }
        .info-text { font-size: 0.85rem; color: #888; }

        /* í•˜ë‹¨ ì˜ìƒ ë²„íŠ¼ & ì™„ë£Œ ì²´í¬ ì˜ì—­ */
        .video-btn-container { display: flex; align-items: stretch; gap: 10px; margin-top: 5px; }
        .mobile-video-btn { flex: 2.5; background: #2563eb; color: white; text-align: center; padding: 13px; border-radius: 12px; text-decoration: none; font-weight: bold; font-size: 1rem; display: flex; align-items: center; justify-content: center; }
        .check-box-area { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; background: #f8fafc; border-radius: 12px; border: 1px solid #e2e8f0; }
        .check-label { font-size: 0.75rem; font-weight: bold; color: #64748b; margin-bottom: 2px; }
        input[type="checkbox"] { width: 26px; height: 26px; accent-color: #2563eb; margin: 0; }

        /* ìˆ˜ì • ëª¨ë“œ ì…ë ¥ì°½ */
        .edit-group { display: flex; flex-direction: column; gap: 8px; }
        .edit-input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px; font-size: 15px; box-sizing: border-box; }
        .save-btn { background: #10b981; color: white; border: none; padding: 12px; border-radius: 10px; font-weight: bold; }

        /* ì™„ë£Œ ìƒíƒœ íš¨ê³¼ */
        .done { opacity: 0.6; background: #f1f5f9; }
        .done .title-text { text-decoration: line-through; color: #94a3b8; }
    </style>
</head>
<body>

<div class="header">
    <a href="admin.html" class="reg-btn-mob">+ ìƒˆ ìˆ˜ì—… ë“±ë¡í•˜ê¸°</a>
    <select id="user-filter" onchange="renderLinks(allDataCache)">
        <option value="ì „ì²´">ëª¨ë“  ì¹œêµ¬ë“¤ ë³´ê¸°</option>
        <option value="í™©ë‹¤ì—°">í™©ë‹¤ì—°</option>
        <option value="ê¹€ë³´ì„">ê¹€ë³´ì„</option>
    </select>
</div>

<div id="mobile-card-container">
    <p style="text-align:center; color:#94a3b8;">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘... ğŸ§¸</p>
</div>

<script>
    // Firebase ì„¤ì • (ë³¸ì¸ì˜ ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”)
    const firebaseConfig = {
        apiKey: "AIzaSyAHvOrb4B3c1uY7WwaR1yuQrwP5lDbRZiI",
        authDomain: "linkmanage-d8efd.firebaseapp.com",
        databaseURL: "https://linkmanage-d8efd-default-rtdb.firebaseio.com",
        projectId: "linkmanage-d8efd",
        storageBucket: "linkmanage-d8efd.firebasestorage.app",
        messagingSenderId: "517672204798",
        appId: "1:517672204798:web:ec8315e84a5120648868af",
        measurementId: "G-6J7VGJ2CXM"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let allDataCache = null;
    let editId = null;

    // ë°ì´í„° ì‹¤ì‹œê°„ ìˆ˜ì‹ 
    db.ref('class_links').on('value', (snap) => {
        allDataCache = snap.val();
        renderLinks(allDataCache);
    });

    // ì™„ë£Œ ì²´í¬ í† ê¸€
    function toggleCheck(id, currentStatus) {
        const now = new Date();
        const timeStr = !currentStatus ? `${now.getMonth()+1}/${now.getDate()} ${now.getHours()}:${String(now.getMinutes()).padStart(2,'0')}` : '-';
        db.ref('class_links/' + id).update({ checked: !currentStatus, doneTime: timeStr });
    }

    // ìˆ˜ì • ëª¨ë“œ ì‹œì‘
    function startEdit(id) {
        editId = id;
        renderLinks(allDataCache);
    }

    // ìˆ˜ì • ì €ì¥ ë° ì¬ì¡°íšŒ
    function saveEdit(id) {
        const card = document.getElementById(`mob-card-${id}`);
        const updateData = {
            title: card.querySelector('.edit-title').value,
            date: card.querySelector('.edit-date').value,
            url: card.querySelector('.edit-url').value
        };

        db.ref('class_links/' + id).update(updateData)
        .then(() => {
            editId = null;
            // ìˆ˜ì • ì™„ë£Œ í›„ ì¦‰ì‹œ ë‹¤ì‹œ ì¡°íšŒí•˜ì—¬ ìµœì‹ í™” ë³´ì¥
            return db.ref('class_links').once('value');
        })
        .then(snap => {
            allDataCache = snap.val();
            renderLinks(allDataCache);
            console.log("ì¬ì¡°íšŒ ì™„ë£Œ âœ¨");
        })
        .catch(err => alert("ì €ì¥ ì‹¤íŒ¨: " + err.message));
    }

    // ì‚­ì œ ê¸°ëŠ¥
    function deleteLink(id) {
        if(confirm("ì •ë§ ì´ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            db.ref('class_links/' + id).remove();
        }
    }

    // í™”ë©´ ë Œë”ë§ í•¨ìˆ˜
    function renderLinks(data) {
        const container = document.getElementById('mobile-card-container');
        const filter = document.getElementById('user-filter').value;
        container.innerHTML = '';

        if(!data) {
            container.innerHTML = '<p style="text-align:center; color:#94a3b8; margin-top:50px;">ë“±ë¡ëœ ìˆ˜ì—…ì´ ì—†ìŠµë‹ˆë‹¤. âœ¨</p>';
            return;
        }

        // ë‚ ì§œ ì—­ìˆœ ì •ë ¬
        const sortedData = Object.values(data).sort((a,b) => new Date(b.date) - new Date(a.date));

        sortedData.forEach(link => {
            if (filter !== "ì „ì²´" && link.user !== filter) return;

            const div = document.createElement('div');
            div.id = `mob-card-${link.id}`;
            div.className = `link-card ${link.checked ? 'done' : ''}`;

            if(editId === link.id) {
                // --- ìˆ˜ì • ëª¨ë“œ UI ---
                div.innerHTML = `
                    <div class="edit-group">
                        <label style="font-size:0.8rem; color:var(--primary); font-weight:bold;">ìˆ˜ì—… ì •ë³´ ìˆ˜ì •</label>
                        <input type="text" class="edit-input edit-title" value="${link.title}" placeholder="ì œëª©">
                        <input type="date" class="edit-input edit-date" value="${link.date}">
                        <input type="text" class="edit-input edit-url" value="${link.url}" placeholder="URL ì£¼ì†Œ">
                        <div style="display:flex; gap:10px;">
                            <button onclick="saveEdit('${link.id}')" class="save-btn" style="flex:2;">ì €ì¥í•˜ê¸°</button>
                            <button onclick="editId=null; renderLinks(allDataCache);" class="btn-mini" style="flex:1;">ì·¨ì†Œ</button>
                        </div>
                    </div>
                `;
            } else {
                // --- ì¼ë°˜ ë³´ê¸° ëª¨ë“œ UI ---
                div.innerHTML = `
                    <div class="card-header">
                        <span class="user-tag">${link.user}</span>
                        <div class="admin-btns">
                            <button onclick="startEdit('${link.id}')" class="btn-mini">ìˆ˜ì •</button>
                            <button onclick="deleteLink('${link.id}')" class="btn-mini">ì‚­ì œ</button>
                        </div>
                    </div>
                    <div class="title-text">${link.title}</div>
                    <div class="info-text">ğŸ“… ${link.date} ${link.checked ? ` | âœ… ${link.doneTime}` : ''}</div>
                    <div class="video-btn-container">
                        <a href="${link.url}" target="_blank" class="mobile-video-btn">â–¶ ì˜ìƒ ë°”ë¡œë³´ê¸°</a>
                        <div class="check-box-area">
                            <span class="check-label">ì™„ë£Œ</span>
                            <input type="checkbox" ${link.checked ? 'checked' : ''} onchange="toggleCheck('${link.id}', ${link.checked})">
                        </div>
                    </div>
                `;
            }
            container.appendChild(div);
        });
    }
</script>

</body>
</html>